{"ast":null,"code":"var _process$env$REACT_AP, _process$env$REACT_AP2, _process$env$REACT_AP3;\nimport axios from 'axios';\nimport qs from 'qs';\nimport jwtDecode from 'jwt-decode';\nimport history from './history';\nconst token_key = 'authData';\nexport const BASE_URL = (_process$env$REACT_AP = process.env.REACT_APP_BACKEND_URL) !== null && _process$env$REACT_AP !== void 0 ? _process$env$REACT_AP : 'http://localhost:8080';\nexport const CLIENT_ID = (_process$env$REACT_AP2 = process.env.REACT_APP_CLIENT_ID) !== null && _process$env$REACT_AP2 !== void 0 ? _process$env$REACT_AP2 : 'dscatalog';\nexport const CLIENT_SECRET = (_process$env$REACT_AP3 = process.env.REACT_APP_CLIENT_SECRET) !== null && _process$env$REACT_AP3 !== void 0 ? _process$env$REACT_AP3 : 'dscatalog123';\nconst basicHeader = () => {\n  return `Basic ${btoa(`${CLIENT_ID}:${CLIENT_SECRET}`)}`;\n};\nexport const requestBackendLogin = loginData => {\n  const headers = {\n    'Content-Type': 'application/x-www-form-urlencoded',\n    Authorization: basicHeader()\n  };\n  const data = qs.stringify({\n    ...loginData,\n    grant_type: 'password'\n  });\n  return axios({\n    method: 'POST',\n    baseURL: BASE_URL,\n    url: '/oauth/token',\n    data,\n    headers\n  });\n};\nexport const requestBackend = config => {\n  const headers = config.withCredentials ? {\n    ...config.headers,\n    Authorization: `Bearer ${getAuthData().access_token}`\n  } : {\n    ...config.headers\n  };\n  return axios({\n    ...config,\n    headers,\n    baseURL: BASE_URL\n  });\n};\naxios.interceptors.request.use(function (config) {\n  return config;\n}, function (error) {\n  return Promise.reject(error);\n});\naxios.interceptors.response.use(function (response) {\n  return response;\n}, function (error) {\n  var _error$response, _error$response2;\n  if ((error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401 || (error === null || error === void 0 ? void 0 : (_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : _error$response2.status) === 403) {\n    history.push('/admin/auth/login');\n  }\n  return Promise.reject(error);\n});\nexport const getTokenData = () => {\n  const token = getAuthData().access_token;\n  try {\n    return jwtDecode(token);\n  } catch (error) {\n    return undefined;\n  }\n};\nexport const isAuthenticated = () => {\n  const tokenData = getTokenData();\n  return tokenData !== undefined && (tokenData === null || tokenData === void 0 ? void 0 : tokenData.exp) * 1000 > Date.now();\n};\nexport const hasAnyRoles = roles => {\n  const tokenData = getTokenData();\n  if (tokenData !== undefined) {\n    return roles.some(role => tokenData.authorities.includes(role));\n  }\n  return false;\n};","map":{"version":3,"names":["axios","qs","jwtDecode","history","token_key","BASE_URL","_process$env$REACT_AP","process","env","REACT_APP_BACKEND_URL","CLIENT_ID","_process$env$REACT_AP2","REACT_APP_CLIENT_ID","CLIENT_SECRET","_process$env$REACT_AP3","REACT_APP_CLIENT_SECRET","basicHeader","btoa","requestBackendLogin","loginData","headers","Authorization","data","stringify","grant_type","method","baseURL","url","requestBackend","config","withCredentials","getAuthData","access_token","interceptors","request","use","error","Promise","reject","response","_error$response","_error$response2","status","push","getTokenData","token","undefined","isAuthenticated","tokenData","exp","Date","now","hasAnyRoles","roles","some","role","authorities","includes"],"sources":["C:/Users/Marcelo Machado/dsCatalog/CatalogoDeProdutos/frontend/catalogodeprodutos/src/util/requests.ts"],"sourcesContent":["import axios, { AxiosRequestConfig } from 'axios';\r\nimport qs from 'qs';\r\nimport jwtDecode from 'jwt-decode';\r\nimport history from './history';\r\n\r\nexport type Role = 'ROLE_OPERATOR' | 'ROLE_ADMIN';\r\n\r\nexport type TokenData = {\r\n  exp: number;\r\n  user_name: string;\r\n  authorities: Role[];\r\n};\r\n\r\ntype LoginResponse = {\r\n  access_token: string;\r\n  token_type: string;\r\n  refresh_token: string;\r\n  expires_in: number;\r\n  scope: string;\r\n  userFirstName: string;\r\n  userId: number;\r\n};\r\n\r\nconst token_key = 'authData';\r\n\r\nexport const BASE_URL =\r\n  process.env.REACT_APP_BACKEND_URL ?? 'http://localhost:8080';\r\n\r\nexport const CLIENT_ID = process.env.REACT_APP_CLIENT_ID ?? 'dscatalog';\r\n\r\nexport const CLIENT_SECRET =\r\n  process.env.REACT_APP_CLIENT_SECRET ?? 'dscatalog123';\r\n\r\nconst basicHeader = () => {\r\n  return `Basic ${btoa(`${CLIENT_ID}:${CLIENT_SECRET}`)}`;\r\n};\r\n\r\ntype LoginData = {\r\n  username: string;\r\n  password: string;\r\n};\r\n\r\nexport const requestBackendLogin = (loginData: LoginData) => {\r\n  const headers = {\r\n    'Content-Type': 'application/x-www-form-urlencoded',\r\n    Authorization: basicHeader(),\r\n  };\r\n  const data = qs.stringify({\r\n    ...loginData,\r\n    grant_type: 'password',\r\n  });\r\n\r\n  return axios({\r\n    method: 'POST',\r\n    baseURL: BASE_URL,\r\n    url: '/oauth/token',\r\n    data,\r\n    headers,\r\n  });\r\n};\r\n\r\nexport const requestBackend = (config: AxiosRequestConfig) => {\r\n  const headers = config.withCredentials\r\n    ? {\r\n        ...config.headers,\r\n        Authorization: `Bearer ${getAuthData().access_token}`,\r\n      }\r\n    : { ...config.headers };\r\n\r\n  return axios({ ...config, headers, baseURL: BASE_URL });\r\n};\r\n\r\naxios.interceptors.request.use(\r\n  function (config) {\r\n    return config;\r\n  },\r\n  function (error) {\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\naxios.interceptors.response.use(\r\n  function (response) {\r\n    return response;\r\n  },\r\n  function (error) {\r\n    if (error?.response?.status === 401 || error?.response?.status === 403) {\r\n      history.push('/admin/auth/login');\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\nexport const getTokenData = (): TokenData | undefined => {\r\n  const token = getAuthData().access_token;\r\n  try {\r\n    return jwtDecode(token) as TokenData;\r\n  } catch (error) {\r\n    return undefined;\r\n  }\r\n};\r\n\r\nexport const isAuthenticated = (): boolean => {\r\n  const tokenData = getTokenData();\r\n  return tokenData !== undefined && tokenData?.exp * 1000 > Date.now();\r\n};\r\n\r\nexport const hasAnyRoles = (roles: Role[]): boolean => {\r\n  const tokenData = getTokenData();\r\n\r\n  if (tokenData !== undefined) {\r\n    return roles.some((role) => tokenData.authorities.includes(role));\r\n  }\r\n\r\n  return false;\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}